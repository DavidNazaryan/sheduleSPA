# Настройка системы аутентификации Telegram

## Обзор

В приложение добавлена система аутентификации через Telegram WebApp API, которая позволяет:
- Идентифицировать пользователей по их Telegram аккаунту
- Назначать роли (студент, староста)
- Разграничивать права доступа
- Позволять старостам добавлять домашние задания

## Настройка

### 1. Создание Telegram бота

1. Откройте [@BotFather](https://t.me/botfather) в Telegram
2. Создайте нового бота командой `/newbot`
3. Следуйте инструкциям и получите токен бота
4. Настройте WebApp командой `/newapp` и выберите вашего бота
5. Укажите URL вашего приложения (например: `https://yourdomain.com`)

### 2. Настройка токена бота

В файле `app/auth.py` замените `YOUR_BOT_TOKEN_HERE` на реальный токен:

```python
TELEGRAM_BOT_TOKEN = "1234567890:ABCdefGHIjklMNOpqrsTUVwxyz"  # Ваш токен
```

### 3. Настройка URL для запуска

В файле `app/templates/index.html` найдите строку:
```javascript
window.location.href='https://t.me/your_bot?startapp=schedule'
```

Замените `your_bot` на имя вашего бота.

## Использование

### Роли пользователей

- **Студент**: может только просматривать расписание своей группы
- **Староста**: может просматривать и редактировать расписание (добавлять домашние задания)

### API эндпоинты

#### Аутентификация
- `POST /api/auth/telegram` - аутентификация через Telegram
- `GET /api/auth/me` - получение информации о текущем пользователе

#### Управление пользователями
- `POST /api/users/role` - изменение роли пользователя
- `GET /api/groups/{group_id}/users` - список пользователей группы

#### Расписание
- `POST /api/schedule/homework` - добавление домашнего задания
- `GET /api/schedule/{group_id}/permissions` - получение прав доступа

### Тестирование

Для тестирования без Telegram используйте кнопку "Тестовый режим" в модальном окне аутентификации.

## Структура данных

### Пользователь
```json
{
  "id": 123456789,
  "first_name": "Иван",
  "last_name": "Петров",
  "username": "ivan_petrov",
  "photo_url": "https://...",
  "role": "monitor",
  "group_id": "group_123"
}
```

### Группа
```json
{
  "group_id": "group_123",
  "group_name": "Группа 123",
  "monitor_user_id": 123456789,
  "student_user_ids": [987654321, 111222333]
}
```

## Безопасность

- Все данные от Telegram проверяются криптографически
- Роли пользователей сохраняются в файле `data/users.json`
- Старосты могут управлять только своей группой
- Студенты видят только расписание своей группы

## Файлы

- `app/auth.py` - аутентификация и проверка прав
- `app/user_management.py` - управление пользователями и группами
- `app/main.py` - API эндпоинты
- `app/templates/index.html` - фронтенд с интеграцией аутентификации
- `data/users.json` - база данных пользователей (создается автоматически)

