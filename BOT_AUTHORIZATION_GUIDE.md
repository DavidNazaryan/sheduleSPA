# üîê –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –Ω–∞ —É—Ä–æ–≤–Ω–µ –±–æ—Ç–∞

## ‚úÖ –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:

### **1. –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏**
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è** –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –æ–±—Ä–∞—â–µ–Ω–∏–∏ –∫ –±–æ—Ç—É
- **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞** –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–æ–ª–µ–π
- **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏** —á–µ—Ä–µ–∑ –±–æ—Ç–∞
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å WebApp** –¥–ª—è seamless –≤—Ö–æ–¥–∞

### **2. –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞**
- `/start` - üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞ –∏ –≤–æ–π—Ç–∏ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
- `/login` - üîê –í–æ–π—Ç–∏ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
- `/help` - ‚ùì –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø—Ä–∞–≤–∫—É –ø–æ –±–æ—Ç—É
- `/status` - üìä –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –±–æ—Ç–∞
- `/myinfo` - üë§ –ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ

### **3. –†–æ–ª–∏ –∏ –ø—Ä–∞–≤–∞**
- **–ì–æ—Å—Ç—å** - –±–∞–∑–æ–≤—ã–π –¥–æ—Å—Ç—É–ø –∫ –ø—Ä–æ—Å–º–æ—Ç—Ä—É
- **–°—Ç—É–¥–µ–Ω—Ç** - –ø—Ä–æ—Å–º–æ—Ç—Ä —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è —Å–≤–æ–µ–π –≥—Ä—É–ø–ø—ã
- **–°—Ç–∞—Ä–æ—Å—Ç–∞** - —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –≥—Ä—É–ø–ø—ã
- **–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä** - –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º —Ñ—É–Ω–∫—Ü–∏—è–º

## üöÄ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏ –∑–∞–ø—É—Å–∫:

### **–®–∞–≥ 1: –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä**
```bash
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

### **–®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –±–æ—Ç–∞**
```bash
python bot_setup.py
```

### **–®–∞–≥ 3: –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é**
1. –û—Ç–∫—Ä–æ–π—Ç–µ –±–æ—Ç–∞: https://t.me/scheduleSPAbot
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ `/start`
3. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–û—Ç–∫—Ä—ã—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ"
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –∫–æ–º–∞–Ω–¥–æ–π `/myinfo`

## üîß –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è:

### **1. –ü–µ—Ä–≤–æ–µ –æ–±—Ä–∞—â–µ–Ω–∏–µ –∫ –±–æ—Ç—É**
```python
# –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç /start
# –ë–æ—Ç —Å–æ–∑–¥–∞–µ—Ç –æ–±—ä–µ–∫—Ç TelegramUser
telegram_user = TelegramUser(
    id=user_id,
    first_name=first_name,
    last_name=last_name,
    username=username,
    role=UserRole.GUEST
)

# –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º
if username and username.lower() == "david_nazaryan":
    telegram_user.role = UserRole.ADMIN

# –ê–≤—Ç–æ—Ä–∏–∑—É–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
bot_auth.authorize_user(telegram_user)
```

### **2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞**
```python
# –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–∞–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
permissions = bot_auth.get_user_permissions(user_id)

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø—Ä–∞–≤–∞
if permissions["can_edit"]:
    # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
    pass
```

### **3. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å WebApp**
```javascript
// –í WebApp –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è initData –æ—Ç Telegram
const initData = window.Telegram.WebApp.initData;

// –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
const response = await fetch('/api/auth/telegram', {
    method: 'POST',
    body: formData
});
```

## üì± –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –æ–ø—ã—Ç:

### **1. –í—Ö–æ–¥ —á–µ—Ä–µ–∑ –±–æ—Ç–∞**
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –±–æ—Ç–∞
2. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `/start` –∏–ª–∏ `/login`
3. –ë–æ—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–Ω–æ–ø–∫—É WebApp
4. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É
5. –û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è WebApp —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π

### **2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞**
- `/myinfo` - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
- `/status` - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—Å –±–æ—Ç–∞
- `/help` - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø—Ä–∞–≤–∫—É

### **3. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤–∞–º–∏**
- –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –º–æ–≥—É—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å –≤—Å–µ–º–∏ –≥—Ä—É–ø–ø–∞–º–∏
- –°—Ç–∞—Ä–æ—Å—Ç—ã –º–æ–≥—É—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å —Å–≤–æ–µ–π –≥—Ä—É–ø–ø–æ–π
- –°—Ç—É–¥–µ–Ω—Ç—ã –º–æ–≥—É—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å

## üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:

### **1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ Telegram**
```python
def verify_telegram_data(self, init_data: str) -> Optional[TelegramUser]:
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–ø–∏—Å—å –¥–∞–Ω–Ω—ã—Ö –æ—Ç Telegram
    if not self._verify_hash(data_dict, hash_value):
        return None
```

### **2. –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –Ω–∞ —É—Ä–æ–≤–Ω–µ –±–æ—Ç–∞**
```python
def authorize_user(self, user: TelegramUser) -> bool:
    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —Å–∏—Å—Ç–µ–º–µ
    user_manager.add_user(user)
    
    # –î–æ–±–∞–≤–ª—è–µ–º –≤ —Å–ø–∏—Å–æ–∫ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö
    self.authorized_users[user.id] = user
```

### **3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞**
```python
def get_user_permissions(self, user_id: int) -> Dict[str, bool]:
    user = self.authorized_users.get(user_id)
    if not user:
        return {"can_view": False, ...}
    
    return {
        "can_view": True,
        "can_edit": user.role == UserRole.MONITOR,
        "can_manage_users": user.role == UserRole.MONITOR or can_manage_all_groups(user),
        "can_manage_all_groups": can_manage_all_groups(user),
        "is_admin": can_manage_all_groups(user)
    }
```

## üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:

### **1. –£–¥–æ–±—Å—Ç–≤–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è**
- ‚úÖ **–û–¥–∏–Ω –∫–ª–∏–∫** –¥–ª—è –≤—Ö–æ–¥–∞ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è** –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –æ–±—Ä–∞—â–µ–Ω–∏–∏
- ‚úÖ **Seamless –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** —Å Telegram

### **2. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**
- ‚úÖ **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏** Telegram
- ‚úÖ **–†–æ–ª–µ–≤–∞—è –º–æ–¥–µ–ª—å** –¥–æ—Å—Ç—É–ø–∞
- ‚úÖ **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏

### **3. –ì–∏–±–∫–æ—Å—Ç—å**
- ‚úÖ **–õ–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å** –Ω–æ–≤—ã–µ —Ä–æ–ª–∏
- ‚úÖ **–ì—Ä–∞–Ω—É–ª—è—Ä–Ω—ã–µ –ø—Ä–∞–≤–∞** –¥–æ—Å—Ç—É–ø–∞
- ‚úÖ **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å WebApp**

## üîÑ –ü—Ä–æ—Ü–µ—Å—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:

```mermaid
sequenceDiagram
    participant U as –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
    participant B as Telegram Bot
    participant S as Backend
    participant W as WebApp

    U->>B: /start
    B->>S: webhook —Å –¥–∞–Ω–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    S->>S: –°–æ–∑–¥–∞–µ—Ç TelegramUser
    S->>S: –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–æ–ª—å (admin/guest)
    S->>S: –ê–≤—Ç–æ—Ä–∏–∑—É–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    S->>B: –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫–Ω–æ–ø–∫—É WebApp
    B->>U: –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–Ω–æ–ø–∫—É
    U->>W: –ù–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É
    W->>S: POST /api/auth/telegram —Å initData
    S->>S: –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–¥–ø–∏—Å—å Telegram
    S->>S: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    S->>W: AuthResponse —Å –¥–∞–Ω–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    W->>U: –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
```

## üö® –û—Ç–ª–∞–¥–∫–∞:

### **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞:**
```bash
# –î–æ–ª–∂–Ω—ã –≤–∏–¥–µ—Ç—å:
INFO: webhook received from user_id: 123456789
INFO: User authorized: David Nazaryan (admin)
INFO: WebApp button sent to chat_id: 123456789
```

### **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞:**
```bash
# –û—Ç–ø—Ä–∞–≤—å—Ç–µ –≤ –±–æ—Ç–∞:
/start
/myinfo
/status
/help
```

### **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ WebApp:**
```javascript
// –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞:
console.log(window.Telegram.WebApp.initData);
console.log(authManager.currentUser);
```

## üéâ –ì–æ—Ç–æ–≤–æ!

–¢–µ–ø–µ—Ä—å —É –≤–∞—Å –µ—Å—Ç—å –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –Ω–∞ —É—Ä–æ–≤–Ω–µ –±–æ—Ç–∞:

1. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏** –≤—Ö–æ–¥—è—Ç —á–µ—Ä–µ–∑ Telegram –±–æ—Ç–∞
2. **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è** –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
3. **–ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞** –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –Ω–∞ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ
4. **WebApp** –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω —Å —Å–∏—Å—Ç–µ–º–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
5. **–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã** –º–æ–≥—É—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å –≤—Å–µ–º–∏ –≥—Ä—É–ø–ø–∞–º–∏

–í–∞—à –±–æ—Ç –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é! üöÄ

